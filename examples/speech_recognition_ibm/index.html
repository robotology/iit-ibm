<!doctype html>
<html>
  <head>
    <title>yarp.js Speech Recognition Example</title>
    <meta name=viewport content="width=device-width, initial-scale=1">
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="mystyle.css">
    <script src="/socket.io/socket.io.js"></script>
    <script src="functions.js" type="text/javascript"></script>
  </head>
  <body>
    <div class='flex-container'>
      <div id="audio_element"></div>
      <ul id="messages" class='flex-console'>
      </ul>
      <div class='flex-commands'>
        <form action = "" id='form-speech-recognition' class="form-inline" style="margin-bottom: 1em">
          <button id='btn-voice' type="button" class="btn" onClick="toggleVoiceBTN(this)" data-toggle="button" aria-pressed="false" autocomplete="off">
            <i class="fa fa-microphone-slash fa-fw" style='margin-right:0.3em' aria-hidden="true"></i>Voice Recognition
          </button>
        </form>
        <form action = "" id='form-speech-synthesis' class="form-inline" style="margin-bottom: 1em">
          <input type="text" class="form-speak" id="speak-message-text" placeholder="Hello yarp js!" value='Hello yarp js!'>
          <button id='btn-speak' type="button" class="btn btn-primary" onClick="speakBTN()" data-toggle="button" aria-pressed="false" autocomplete="off">
            <i class="fa fa-bullhorn fa-fw" style='margin-right:0.3em' aria-hidden="true"></i>Speak
          </button>
        </form>
        <form style="font-size: 1.2em">
          <label class="radio-inline" style"marign-left:1em;">
          <input type="radio" name="language" onClick="toggleLanguageEN()" id="inlineRadio1" value="en" checked> English
          </label>
          <label class="radio-inline" style="margin-left:0.5em">
            <input type="radio" name="language" onClick="toggleLanguageIT()" id="inlineRadio2" value="it"> Italian
          </label>
        </form>
      </div>
    </div>
  </body>
  <script src="/jquery/dist/jquery.min.js"></script>
  <script src="/yarp.js"></script>

  <script>
    var socket = io();
    yarp.init(socket);

    var acquisition_period = 10;
    var sample_rate = 16000;
    var num_seconds = 1;
    var bit_depth = 16;
    var num_samples = sample_rate*num_seconds;
    var num_channels = 1;

    // what to do as soon as the yarp module is ready
    yarp.onInit(function() {
      // open Yarp Sound Port
      var yarpPortReceiver = yarp.PortHandler.openPort('/receiver','sound');
      // Connecting Ports
      yarp.Network.connect('/sender','/receiver');
      //Sound from sender
      //var messages = new ArrayBuffer((num_samples*2)*acquisition_period);
      var uint8 = new Uint8Array((num_samples*2)*acquisition_period);
      var i = 0;
      var stop = false;
      yarpPortReceiver.onRead(function(msg)
      {
          if (!stop)
          {
              var view = new DataView(msg.content);
              for(var j = 0; j < (num_samples*2); j++ )
              {uint8.set([view.getUint8(j)],j + i*(num_samples*2));}
              if(i == (acquisition_period - 1))
              {
                  var file_content = getData(uint8, sample_rate);
                  download(file_content);
                  stop = true;
              }
              i++;
          }
      })
  });
 </script>
</html>
