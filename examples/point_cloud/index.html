
<html lang="en">
  <head>
    <title>yarp.js Three Point Cloud</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="mystyle.css">
    <script src="functions.js" type="text/javascript"></script>
  </head>
  <body>
    <div id='description'>
      <div class='closebutton'>x</div>
      <h1>Point Cloud Visualization</h1>
      <p>
        This application shows how to visualize 3D data with with <b>yarp.js</b> using the <a target='_blank' href='http://threejs.org/'>Three.js</a> library. You can dynamically add new points to the current scene by writing their coordinates to the port <b>/yarpjs/3Dpoints:i</b> using format <b>(x y z R G B size)</b>. RGB colour defaults to black (0 0 0) and size defaults to 5. You can send multiple points at the same time by concatenating bottles (e.g. (b1) (b2) ... (bn)).
      </p>
      <p>
        For an example of dynamic point cloud visualization run the shell command <b>$> node examples/point_cloud/send_point_cloud.js</b> from the directory where yarp.js was pulled.
      </p>
    </div>
    <script src="/three/build/three.js"></script>
    <script src="/three/examples/js/controls/OrbitControls.js"></script>
    <script src="/three/examples/js/controls/FirstPersonControls.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="/yarp.js"></script>
    <script>

      var socket = io();
      yarp.init(socket);

      // what to do as soon as the yarp module is ready
      yarp.onInit(function() {

        var port_3D_points = yarp.PortHandler.openPort('/yarpjs/3Dpoints:i');

        port_3D_points.onRead(function(bottle){

          if(bottle.content.length>0)
            addPoint(bottle.content);

        });

      });

      String.prototype.format = function () {

        var str = this;
        for ( var i = 0; i < arguments.length; i ++ ) {

          str = str.replace( '{' + i + '}', arguments[ i ] );

        }
        return str;

      }

      var container;
      var camera, scene, renderer;
      var options;


      var MAX_POINTS = 100000;
      var materials, particles;

      var default_size = 5;
      var default_color = [0,0,0];

      var counter_draw_points = 1;

      init();
      animate();


      var description_object = document.getElementById('description');

      description_object.getElementsByClassName('closebutton')[0].onclick = function closeDescription() {
        description_object.classList.add('invisible');
      }

      var route_parameters = location.search.substring(1).split("&");

      var description_visible = false;
      for(var route_idx=0; route_idx<route_parameters.length; route_idx++)
      {
        var route_tmp = route_parameters[0].split("=");
        if(route_tmp[0] == 'description' && !(!unescape(route_tmp[1])) == true)
        {
          description_visible = true;
        }
      }

      if(!description_visible)
      {
        description_object.classList.add('invisible');
      }
      </script>
  </body>
</html>
