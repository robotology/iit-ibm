<!doctype html>
<html>
  <head>
    <title>yarp.js Message to IBM</title>
    <meta name=viewport content="width=device-width, initial-scale=1">
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="mystyle.css">
    <script src="/socket.io/socket.io.js"></script>
  </head>
  <body>
    <div class='flex-container'>
      <ul id="messages" class='flex-console'>
      </ul>
      <div class='flex-commands'>
        <form action = "" id='form-messages-ibm' class="form-inline" style="margin-bottom: 1em" onsubmit="return false">
          <input type="text" class="form-speak" id="send-message-text" placeholder="" value='Hello' onkeydown="MsgToIBM_EnterClick(event, this)">
          <p>
          </p>
          <button id='btn-send' type="button" class="btn btn-primary" onClick="MsgToIBM_OnClick()" data-toggle="button" aria-pressed="false" autocomplete="off">
            <i class="fa fa-envelope fa-fw" style='margin-right:0.3em' aria-hidden="true"></i>Send to IBM
          </button>
        </form>
      </div>
      <div id='description' class='visible'>
        <h1>Message from and to IBM Cloud</h1>
        <p class='danger'>! This demo works on any browsers</p>
        <p>
          This example shows how send and receive messages to IBM Cloud over the YARP network as a
          string within a Bottle. Sentences to IBM are written by the port <b>/yarpjs/send:o</b>
          and received by the port <b>/yarpjs/receive:i</b>. IBM Cloud provides Watson Assistant
          service with which you can create a dialog to automate interactions between user
          and the system where YARP is running.
          <p><b>You can quickly build a natural conversation flow now!</b></p>
        </p>
      </div>
  </body>
  <script src="/jquery/dist/jquery.min.js"></script>
  <script src="/yarp.js"></script>
  <script>
  var socket = io();
  yarp.init(socket);

  // Message YARP open ports for writing/reading text messages
  var yarp_write_text_port = yarp.PortHandler.openPort('/yarp_text/sender:o');
  var yarp_read_text_port = yarp.PortHandler.openPort('/yarp_text/receiver:i');

    yarp.onInit(function()
    {
        // ports connection with IBM's ports
        yarp.Network.connect('/yarp_text/sender:o','/ibm_text/receiver:i');
        yarp.Network.connect('/ibm_text/sender:o','/yarp_text/receiver:i');

        yarp_read_text_port.onRead(function(msg)
        {
            var Messages = '';
            for(var i=0; i<msg.content.length; i++)
            {
                Messages += msg.content[i] + ' ';
            }
            $('#messages').append('<li><samp class="reply-from-server">$>Messages from IBM:<br>'+Messages+'</samp></li><br>');
        })
    });

// Functions with ports
    function MsgToIBM_OnClick(msg)
    {
        var msg = $('#send-message-text').val();
        yarp_write_text_port.write(msg);
        $('#send-message-text').val('');

   }

    function MsgToIBM_EnterClick(event, msg)
    {
        var msg = $('#send-message-text').val();
        if (event.keyCode === 13)
        {
            yarp_write_text_port.write(msg);
            $('#send-message-text').val('');
        }
    }
  </script>
</html>
